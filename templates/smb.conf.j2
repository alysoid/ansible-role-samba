# {{ ansible_managed }}
# Samba configuration file
# See smb.conf(5) for details.

[global]
  # Server information
  workgroup = {{ samba_workgroup }}
  server string = {{ samba_server_string }}
  disable netbios = yes

  # Logging
{% if samba_log is defined %}
  log file = {{ samba_log }}
  max log size = {{ samba_log_size }}
  log level = {{ samba_log_level }}
{% else %}
  logging = syslog
{% endif %}

  # Authentication
  security = {{ samba_security }}
  passdb backend = {{ samba_passdb_backend }}
  map to guest = {{ samba_map_to_guest }}
{% if samba_guest_account  is defined %}
  guest account = {{ samba_guest_account }}
{% endif %}
{% if samba_username_map is defined %}
  username map = {{ samba_username_map_file }}
{% endif %}

{% if samba_server_min_protocol is defined %}
  # Minimum protocol version offered by the server
  server min protocol = {{ samba_server_min_protocol }}

{% endif %}
{% if samba_server_max_protocol is defined %}
  # Maximum protocol version offered by the server
  server max protocol = {{ samba_server_max_protocol }}

{% endif %}
  # Don't load printers
  load printers = no
  printing = bsd
  printcap name = /dev/null
  disable spoolss = yes

{% if samba_veto_files is defined %}
  veto files = {{ samba_veto_files }}
  delete veto files = yes
{% endif %}

{% if samba_shares | length > 0 %}
# Shared directories
{% for share in samba_shares %}
[{{ share.name }}]
{% if share.comment is defined %}
  comment = {{ share.comment }}
{% endif %}
  path = {{ share.path | default([samba_shares_root,share.name] | join('/')) }}
  public = {{ share.public | default('no') }}
{% if share.valid_users is defined %}
  valid users= {{ share.valid_users }}
{% endif %}
{% if share.write_list is defined %}
  write list = {{ share.write_list }}
{% endif %}
{% if share.group is defined %}
  force group = {{ share.group }}
{% endif %}
{% if share.guest_ok is defined %}
  guest ok = {{ share.guest_ok }}
{% endif %}
{% if share.browseable is defined %}
  browseable = {{ share.browseable }}
{% endif %}
{% if share.writable is defined %}
  writable = {{ share.writable }}
{% endif %}
  create mode = {{ share.create_mode | default('0664') }}
  force create mode = {{ share.force_create_mode | default('0664') }}
  directory mode = {{ share.directory_mode | default('0775') }}
  force directory mode = {{ share.force_directory_mode | default('0775') }}

{% endfor %}
{% endif%}
